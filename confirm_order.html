<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Konfirmasi Pesanan</title>
    <link rel="icon" href="folder_gambar/logo.jpg" type="image/icon type">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <section class="main">
            <a class="logo" href="#"><img src="folder_gambar/logo.jpg" alt="Logo"></a>
            <div class="fix">
                <a class="a1" href="index.html">HOME <i class="bx bx-home"></i></a>
            </div>
        </section>
    </header>

    <div>
        <section class="menu-template" id="id-menu">
            <center>
                <h3 class="menu-subtitle">JURAGAN &nbsp;&nbsp;BAKSO.ID</h3>
            </center>
        </section>

        <?php
        $conn = new mysqli("localhost:3307", "root", "", "bakso_order");

        if ($conn->connect_error) {
            die("Connection failed: " . $conn->connect_error);
        }

        if (isset($_GET['order_id'])) {
            $order_id = $_GET['order_id'];
            $sql = "SELECT * FROM orders WHERE id = ?";
            $stmt = $conn->prepare($sql);
            $stmt->bind_param("i", $order_id);
            $stmt->execute();
            $result = $stmt->get_result();
        
            if ($result->num_rows > 0) {
                $order = $result->fetch_assoc();
            } else {
                echo "<p>Order tidak ditemukan.</p>";
                exit;
            }
        } else {
            echo "<p>Order ID tidak ditemukan.</p>";
            exit;
        }
        ?>

        <section class="order-details">
            <h2>Detail Pesanan</h2>
            <form id="update_order_form" onsubmit="updateOrder(event)">
                <input type="hidden" name="order_id" value="<?php echo $order['order_id']; ?>">
                <label for="name">Nama:</label>
                <input type="text" id="name" name="name" value="<?php echo $order['name']; ?>" required><br>

                <label for="number">No Telepon:</label>
                <input type="text" id="number" name="number" value="<?php echo $order['phone']; ?>" required><br>

                <label for="address">Alamat:</label>
                <textarea id="address" name="address" required><?php echo $order['address']; ?></textarea><br>

                <label for="order_details">Total Harga:</label>
                <input type="text" id="order_details" name="order_details" value="Rp <?php echo number_format($order['total_price'], 0, ',', '.'); ?>" readonly><br>

                <label for="order_date">Tanggal Pemesanan:</label>
                <input type="text" id="order_date" name="order_date" value="<?php echo date('d F Y H:i', strtotime($order['order_date'])); ?>" readonly><br>

                <p align="center"><button type="submit" name="action" value="update">Perbarui Pesanan</button></p>
                <p align="center"><button type="submit" name="action" value="confirm">Konfirmasi Pesanan</button></p>
                <p align="center"><button type="submit" name="action" value="delete" style="background-color: red;">Hapus Pesanan</button></p>
            </form>

            <script>
                function updateOrder(event) {
                    event.preventDefault();

                    const formData = new FormData(document.getElementById('update_order_form'));

                    fetch('order.php', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                        if (data.status === 'success') {
                            window.location.href = 'index.html';
                        }
                    })
                    .catch(error => console.error('Error:', error));
                }
            </script>
        </section>
    </div>
</body>
</html>